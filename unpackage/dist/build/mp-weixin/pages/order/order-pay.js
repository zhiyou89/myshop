(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/order-pay"],{"0ca2":function(e,t,r){"use strict";var n=r("8869"),o=r.n(n);o.a},"361d":function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){return n}));var n={uniIcons:function(){return Promise.all([r.e("common/vendor"),r.e("components/uni-icons/uni-icons")]).then(r.bind(null,"f812"))},priceType:function(){return r.e("components/price-type/price-type").then(r.bind(null,"bf48"))}},o=function(){var e=this,t=e.$createElement;e._self._c},i=[]},"3ec6":function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=c(r("a34a")),o=c(r("8b1f")),i=c(r("b055")),u=c(r("eeb2"));function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t,r,n,o,i,u){try{var c=e[i](u),d=c.value}catch(a){return void r(a)}c.done?t(d):Promise.resolve(d).then(n,o)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function u(e){d(i,n,o,u,c,"next",e)}function c(e){d(i,n,o,u,c,"throw",e)}u(void 0)}))}}var s=function(){Promise.all([r.e("common/vendor"),r.e("components/uni-popup/uni-popup")]).then(function(){return resolve(r("17f1"))}.bind(null,r)).catch(r.oe)},l=function(){r.e("components/uni-tag/uni-tag").then(function(){return resolve(r("5470"))}.bind(null,r)).catch(r.oe)},f=function(){r.e("components/price-type/price-type").then(function(){return resolve(r("bf48"))}.bind(null,r)).catch(r.oe)},p={data:function(){return{from:"",productId:0,productOne:[],productArr:[],account:0,deliverTime:"7:00-9:00",deliverFree:3,couponFree:0,payMoney:0,nowDeliverProduct:[],realDeliverProduct:[],tomorrowDeliverProduct:[],dataArr:[],address:[],timeArr:["7:00-9:00","9:00-11:00","11:00-13:00","13:00-15:00","15:00-17:00","17:00-19:00","19:00-21:00"]}},components:{uniPopup:s,uniTag:l,priceType:f},methods:{cartIcon:function(){},chooseTime:function(){this.$refs.popup.open()},_deliverTime:function(e){this.deliverTime=e,this.$refs.popup.close()},getProductOne:function(e){var t=this;return a(n.default.mark((function r(){var o,i;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$myrequest({url:"/product",data:{id:t.productId}});case 2:o=r.sent,t.productOne=o,i=[],i.push({id:t.productOne.id,price:t.productOne.price,index_category_id:t.productOne.index_category_id,main_img_url:t.productOne.main_img_url,counts:1}),console.log(i),"即时配送"==t.productOne.index_category_id&&(t.nowDeliverProduct=i),"隔天配送"==t.productOne.index_category_id&&(t.tomorrowDeliverProduct=i),"实时物流"==t.productOne.index_category_id&&(t.realDeliverProduct=i),e&&e();case 11:case"end":return r.stop()}}),r)})))()},chooseAddress:function(){var t=this;t.address=e.getStorageSync(i.default.storageKeyForAddress),t.address.length<=0&&e.chooseAddress({success:function(r){var n=[],o={type:0,nameByChooseAddress:r.cityName+r.countyName,detailInfo:r.detailInfo,userName:r.userName,telNumber:r.telNumber};n.push(o),e.setStorageSync(i.default.storageKeyForAddress,n),t.address=n},fail:function(t){e.showToast({title:"获取地址失败",duration:2e3})}})},_isHasThatOne:function(e,t){for(var r,n={index:-1},o=0;o<t.length;o++)if(r=t[o],console.log(r.id,"itemid"),console.log(e,"id"),r.id==e){n={index:o,data:r};break}return n},delete:function(t){t instanceof Array||(t=[t]);for(var r=e.getStorageSync(i.default.storageKeyForCart),n=0;n<t.length;n++){var o=this._isHasThatOne(t[n].id,r);-1!=o.index&&r.splice(o.index,1)}e.setStorageSync(i.default.storageKeyForCart,r)},pay:function(){var t=this;return a(n.default.mark((function r(){var o,c,d,a,s,l;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(o=t,u.default.checkTokenOrGetToken(),!(t.address.length<=0)){r.next=5;break}return e.showToast({title:"送货地址不能为空",duration:2e3}),r.abrupt("return",!1);case 5:for(c={hope_time:t.deliverTime,price:t.deliverFree},e.getStorageSync(i.default.storageKeyForToken),d=[],a=0;a<t.productArr.length;a++)d.push({product_id:t.productArr[a].id,count:t.productArr[a].counts});return r.next=11,t.$myrequest({url:"/place_order",method:"POST",data:{products:d,delivery:c,address:t.address[0]}});case 11:if(s=r.sent,console.log(s),!s.pass){r.next=18;break}return r.next=16,t.$myrequest({url:"/pay/pre_order",method:"POST",data:{id:s.order_id}});case 16:l=r.sent,l.nonceStr&&l.paySign&&l.package&&(o.delete(o.productArr),e.requestPayment({provider:"wxpay",timeStamp:l.timeStamp.toString(),nonceStr:l.nonceStr,package:l.package,signType:l.signType,paySign:l.paySign,success:function(t){if(console.log(t),"requestPayment:ok"==t.errMsg){s.order_id;e.showToast({title:"订单支付成功"}),setTimeout((function(){e.redirectTo({url:"/pages/order/detail?status=3&order_id="+s.order_id})}),1500)}},fail:function(t){e.showToast({title:"订单支付失败",icon:"none"}),setTimeout((function(){e.redirectTo({url:"/pages/order/detail?status=1&order_id="+s.order_id})}),1500),console.log("fail:"+JSON.stringify(t))}}));case 18:case"end":return r.stop()}}),r)})))()}},onLoad:function(t){var r=e.getStorageSync("setting");this.deliverFree=r.delivery_free,this.from=t.from,"good"==t.from?(this.productId=t.product_id,this.getProductOne(),this.productArr.push({id:this.productId,counts:1})):(this.nowDeliverProduct=o.default.getNowDeliverProduct(),this.realDeliverProduct=o.default.getRealDeliverProduct(),this.tomorrowDeliverProduct=o.default.getTomorrowDeliverProduct(),this.productArr=o.default.getPayProductFromStorageSync());var n=100*t.account+100*this.deliverFree-100*this.couponFree;this.account=n.toFixed(2)},onShow:function(){this.address=e.getStorageSync(i.default.storageKeyForAddress)},onHide:function(){console.log("onhide")}};t.default=p}).call(this,r("543d")["default"])},"77a1":function(e,t,r){"use strict";r.r(t);var n=r("3ec6"),o=r.n(n);for(var i in n)"default"!==i&&function(e){r.d(t,e,(function(){return n[e]}))}(i);t["default"]=o.a},8869:function(e,t,r){},"8b59":function(e,t,r){"use strict";(function(e){r("ffa8");n(r("66fd"));var t=n(r("c751"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])},c751:function(e,t,r){"use strict";r.r(t);var n=r("361d"),o=r("77a1");for(var i in o)"default"!==i&&function(e){r.d(t,e,(function(){return o[e]}))}(i);r("0ca2");var u,c=r("f0c5"),d=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],u);t["default"]=d.exports}},[["8b59","common/runtime","common/vendor"]]]);